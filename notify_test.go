package discord_notification_function

import (
	"net/http"
	"net/http/httptest"
	"strings"
	"testing"
)

const testBuildMessage = `{"Message":{"Attributes":{"BuildID":"93568b94-ea76-4a58-acda-16b37ced73b8", "Status":"SUCCESS"}, "Data":"ewogICJpZCI6ICI5MzU2OGI5NC1lYTc2LTRhNTgtYWNkYS0xNmIzN2NlZDczYjgiLAogICJzdGF0dXMiOiAiU1VDQ0VTUyIsCiAgInNvdXJjZSI6IHsKICB9LAogICJjcmVhdGVUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDA6NDIuNTQxNjY4NDY1WiIsCiAgInN0YXJ0VGltZSI6ICIyMDIxLTAzLTEyVDAxOjAwOjQzLjM2MjEyOTAwMloiLAogICJmaW5pc2hUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDE6MTUuNTQyMjM1WiIsCiAgInJlc3VsdHMiOiB7CiAgICAiYnVpbGRTdGVwSW1hZ2VzIjogWyIiLCAiIiwgIiJdLAogICAgImJ1aWxkU3RlcE91dHB1dHMiOiBbIiIsICIiLCAiIl0KICB9LAogICJzdGVwcyI6IFt7CiAgICAibmFtZSI6ICJoYXNoaWNvcnAvdGVycmFmb3JtOjAuMTQuNyIsCiAgICAiYXJncyI6IFsiaW5pdCJdLAogICAgInRpbWluZyI6IHsKICAgICAgInN0YXJ0VGltZSI6ICIyMDIxLTAzLTEyVDAxOjAwOjQ3LjQ0MTQ2ODgwOFoiLAogICAgICAiZW5kVGltZSI6ICIyMDIxLTAzLTEyVDAxOjAxOjAxLjg5NTAzNDk4MloiCiAgICB9LAogICAgInN0YXR1cyI6ICJTVUNDRVNTIiwKICAgICJwdWxsVGltaW5nIjogewogICAgICAic3RhcnRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDA6NDcuNDQxNDY4ODA4WiIsCiAgICAgICJlbmRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDA6NTEuMjY3Nzg3NzUzWiIKICAgIH0KICB9LCB7CiAgICAibmFtZSI6ICJoYXNoaWNvcnAvdGVycmFmb3JtOjAuMTQuNyIsCiAgICAiYXJncyI6IFsidmFsaWRhdGUiXSwKICAgICJ0aW1pbmciOiB7CiAgICAgICJzdGFydFRpbWUiOiAiMjAyMS0wMy0xMlQwMTowMTowMS44OTUxMjA5OThaIiwKICAgICAgImVuZFRpbWUiOiAiMjAyMS0wMy0xMlQwMTowMTowNS4yMTQ2ODY4MzlaIgogICAgfSwKICAgICJzdGF0dXMiOiAiU1VDQ0VTUyIsCiAgICAicHVsbFRpbWluZyI6IHsKICAgICAgInN0YXJ0VGltZSI6ICIyMDIxLTAzLTEyVDAxOjAxOjAxLjg5NTEyMDk5OFoiLAogICAgICAiZW5kVGltZSI6ICIyMDIxLTAzLTEyVDAxOjAxOjAxLjg5NjI2MDg0MFoiCiAgICB9CiAgfSwgewogICAgIm5hbWUiOiAiaGFzaGljb3JwL3RlcnJhZm9ybTowLjE0LjciLAogICAgImFyZ3MiOiBbInBsYW4iLCAiLW91dCIsICJ0Zi5wbGFuIl0sCiAgICAidGltaW5nIjogewogICAgICAic3RhcnRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDE6MDUuMjE0ODMxMTM5WiIsCiAgICAgICJlbmRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDE6MTQuOTAxNTE5MjE0WiIKICAgIH0sCiAgICAic3RhdHVzIjogIlNVQ0NFU1MiLAogICAgInB1bGxUaW1pbmciOiB7CiAgICAgICJzdGFydFRpbWUiOiAiMjAyMS0wMy0xMlQwMTowMTowNS4yMTQ4MzExMzlaIiwKICAgICAgImVuZFRpbWUiOiAiMjAyMS0wMy0xMlQwMTowMTowNS4yMTYxODU2MzdaIgogICAgfQogIH1dLAogICJ0aW1lb3V0IjogIjYwMHMiLAogICJwcm9qZWN0SWQiOiAidGVsdmFubmktcGxhdGZvcm0iLAogICJsb2dzQnVja2V0IjogImdzOi8vNjgxNjM2OTI0ODMyLmNsb3VkYnVpbGQtbG9ncy5nb29nbGV1c2VyY29udGVudC5jb20iLAogICJzb3VyY2VQcm92ZW5hbmNlIjogewogIH0sCiAgImJ1aWxkVHJpZ2dlcklkIjogImI1YzRjOWY5LWIzNmQtNGZhMC1hNjAxLTY0Zjg4YmRkZTMzMiIsCiAgIm9wdGlvbnMiOiB7CiAgICAic3Vic3RpdHV0aW9uT3B0aW9uIjogIkFMTE9XX0xPT1NFIiwKICAgICJsb2dnaW5nIjogIkxFR0FDWSIsCiAgICAiZHluYW1pY1N1YnN0aXR1dGlvbnMiOiB0cnVlCiAgfSwKICAibG9nVXJsIjogImh0dHBzOi8vY29uc29sZS5jbG91ZC5nb29nbGUuY29tL2Nsb3VkLWJ1aWxkL2J1aWxkcy85MzU2OGI5NC1lYTc2LTRhNTgtYWNkYS0xNmIzN2NlZDczYjg/cHJvamVjdFx1MDAzZDY4MTYzNjkyNDgzMiIsCiAgInN1YnN0aXR1dGlvbnMiOiB7CiAgICAiQ09NTUlUX1NIQSI6ICI1YjZhMmFjOTdkOTA5MjA1OGY1NmY1NDcxMzE3OTI0ZWNkOWRmN2FkIiwKICAgICJTSE9SVF9TSEEiOiAiNWI2YTJhYyIsCiAgICAiQlJBTkNIX05BTUUiOiAibWFpbiIsCiAgICAiX1RFUlJBRk9STV9WRVJTSU9OIjogIjAuMTQuNyIsCiAgICAiUkVQT19OQU1FIjogInRmLXBsYXRmb3JtIiwKICAgICJSRVZJU0lPTl9JRCI6ICI1YjZhMmFjOTdkOTA5MjA1OGY1NmY1NDcxMzE3OTI0ZWNkOWRmN2FkIgogIH0sCiAgInRhZ3MiOiBbInRyaWdnZXItYjVjNGM5ZjktYjM2ZC00ZmEwLWE2MDEtNjRmODhiZGRlMzMyIl0sCiAgInRpbWluZyI6IHsKICAgICJGRVRDSFNPVVJDRSI6IHsKICAgICAgInN0YXJ0VGltZSI6ICIyMDIxLTAzLTEyVDAxOjAwOjQ0Ljc0ODY4ODU5MloiLAogICAgICAiZW5kVGltZSI6ICIyMDIxLTAzLTEyVDAxOjAwOjQ2Ljc3ODI2Njc4MVoiCiAgICB9LAogICAgIkJVSUxEIjogewogICAgICAic3RhcnRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDA6NDYuNzc4MzU2MzM4WiIsCiAgICAgICJlbmRUaW1lIjogIjIwMjEtMDMtMTJUMDE6MDE6MTQuOTAxNjQ4NDgzWiIKICAgIH0KICB9LAogICJxdWV1ZVR0bCI6ICIzNjAwcyIsCiAgIm5hbWUiOiAicHJvamVjdHMvNjgxNjM2OTI0ODMyL2xvY2F0aW9ucy9nbG9iYWwvYnVpbGRzLzkzNTY4Yjk0LWVhNzYtNGE1OC1hY2RhLTE2YjM3Y2VkNzNiOCIKfQ==", "MessageID":2137525196767775}, "Subscription":"projects/telvanni-platform/subscriptions/push"}`

func TestGetBuildMessage(t *testing.T) {
	request := httptest.NewRequest(http.MethodPost, "/", strings.NewReader(testBuildMessage))
	request.Header.Add("Content-Type", "application/json")
	rr := httptest.NewRecorder()

	GetBuildMessage(rr, request)

}
