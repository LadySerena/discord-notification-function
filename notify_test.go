package discord_notification_function

import (
	"net/http"
	"net/http/httptest"
	"strings"
	"testing"
)

const testBuildMessage = `{"message":{"attributes":{"buildId":"5610b0b6-db63-4c33-948a-125e0a2e2f30","status":"WORKING"},"data":"eyJpZCI6IjU2MTBiMGI2LWRiNjMtNGMzMy05NDhhLTEyNWUwYTJlMmYzMCIsInByb2plY3RJZCI6Im1pbmVjcmFmdC1zZXJ2ZXItdGllZGUiLCJzdGF0dXMiOiJXT1JLSU5HIiwic291cmNlIjp7InJlcG9Tb3VyY2UiOnsicHJvamVjdElkIjoibWluZWNyYWZ0LXNlcnZlci10aWVkZSIsInJlcG9OYW1lIjoiYmFzZS1pbWFnZSIsImJyYW5jaE5hbWUiOiJtYXN0ZXIifX0sInN0ZXBzIjpbeyJuYW1lIjoiZ2NyLmlvL21pbmVjcmFmdC1zZXJ2ZXItdGllZGUvcGFja2VyLWJ1aWxkZXI6bGF0ZXN0IiwiYXJncyI6WyJ2YWxpZGF0ZSIsImJhc2UuanNvbiJdfSx7Im5hbWUiOiJnY3IuaW8vbWluZWNyYWZ0LXNlcnZlci10aWVkZS9wYWNrZXItYnVpbGRlcjpsYXRlc3QiLCJhcmdzIjpbImJ1aWxkIiwiYmFzZS5qc29uIl19XSwiY3JlYXRlVGltZSI6IjIwMjAtMDYtMDdUMjI6NDA6MzcuNzM4NjUzMDg0WiIsInN0YXJ0VGltZSI6IjIwMjAtMDYtMDdUMjI6NDA6MzguMzcxMTcwOTAwWiIsInRpbWVvdXQiOiI2MDBzIiwicXVldWVUdGwiOiIzNjAwcyIsImxvZ3NCdWNrZXQiOiJnczovLzEwNTkxMTMwMjA3MTguY2xvdWRidWlsZC1sb2dzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInNvdXJjZVByb3ZlbmFuY2UiOnsicmVzb2x2ZWRSZXBvU291cmNlIjp7InByb2plY3RJZCI6Im1pbmVjcmFmdC1zZXJ2ZXItdGllZGUiLCJyZXBvTmFtZSI6ImJhc2UtaW1hZ2UiLCJjb21taXRTaGEiOiI2ZTBhZGQ3NmVjYzcxZjI0NmY3MmRiNzA0N2E2OTk4MjZjMzU2ZjUwIn19LCJidWlsZFRyaWdnZXJJZCI6ImI2MzRiNjgxLTQ2YmMtNDk2Zi05M2YzLTk4MjY3NzZjOGE3MiIsIm9wdGlvbnMiOnsic3Vic3RpdHV0aW9uT3B0aW9uIjoiQUxMT1dfTE9PU0UiLCJsb2dnaW5nIjoiTEVHQUNZIn0sImxvZ1VybCI6Imh0dHBzOi8vY29uc29sZS5jbG91ZC5nb29nbGUuY29tL2Nsb3VkLWJ1aWxkL2J1aWxkcy81NjEwYjBiNi1kYjYzLTRjMzMtOTQ4YS0xMjVlMGEyZTJmMzA/cHJvamVjdD0xMDU5MTEzMDIwNzE4Iiwic3Vic3RpdHV0aW9ucyI6eyJCUkFOQ0hfTkFNRSI6Im1hc3RlciJ9LCJ0YWdzIjpbInRyaWdnZXItYjYzNGI2ODEtNDZiYy00OTZmLTkzZjMtOTgyNjc3NmM4YTcyIl19","messageId":"1260108140496274","message_id":"1260108140496274","publishTime":"2020-06-07T22:40:39.028Z","publish_time":"2020-06-07T22:40:39.028Z"},"subscription":"projects/minecraft-server-tiede/subscriptions/discord-notifications"}`

func TestGetBuildMessage(t *testing.T) {
	request := httptest.NewRequest(http.MethodPost, "/", strings.NewReader(testBuildMessage))
	request.Header.Add("Content-Type", "application/json")
	rr := httptest.NewRecorder()

	GetBuildMessage(rr, request)

}
